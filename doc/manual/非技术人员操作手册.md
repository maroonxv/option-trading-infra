# 商品卖权震荡策略 - 操作手册

**适用人群**：策略使用者（无需编程基础）

本手册将指导您如何配置环境并运行策略。

---

## 0. 环境准备（初次运行必看）

在第一次启动策略前，请确保您的电脑已安装 **Python**，并按照以下步骤操作：

1.  **打开命令窗口**：在当前文件夹的空白处，按住键盘上的 `Shift` 键，同时点击鼠标右键，选择“在此处打开 PowerShell 窗口”或“在此处打开命令窗口”。
2.  **创建虚拟环境**：在弹出的窗口中输入以下指令并回车：
    ```powershell
    python -m venv .venv
    ```
3.  **安装运行依赖**：继续输入以下指令并回车（这可能需要几分钟时间）：
    ```powershell
    .venv\Scripts\pip install -r requirements.txt
    ```

**提示**：如果您看到“安装成功”的提示，说明环境已经配置好了。以后除非更换电脑或技术人员要求，否则无需再次执行此操作。

---

## 1. 桌面快捷方式（启动脚本）

在项目根目录下，我们为您准备了 4 个常用脚本，直接双击即可运行。

| 文件名 | 功能描述 | 什么时候用？ |
| :--- | :--- | :--- |
| **`run.bat`** | **启动实盘/仿真交易** | 交易时间段，准备正式跑策略时。会自动连接账户并开始根据行情交易。 |
| **`run_backtesting.bat`** | **运行历史回测** | 收盘后。想看看策略在过去一年（或指定时间）的表现，验证策略逻辑时。 |
| **`run_datarecorder.bat`** | **仅录制行情** | 需要收集数据但不交易时。或者在非交易时间测试行情连接时。 |
| **`run_paper.bat`** | **模拟交易模式** | 类似于实盘，但是是模拟撮合，资金和成交都是虚拟的。用于测试策略逻辑是否正常。 |

---

## 2. 如何修改回测设置？

如果您想修改回测的**开始时间**、**结束时间**或**初始资金**，请修改 `run_backtesting.bat` 文件（右键 -> 编辑）。

或者更简单地，直接联系开发人员修改 `src/backtesting/run_backtesting.py` 中的默认参数，或者在命令行中运行并带上参数（仅限高级用户）。

**常用回测参数说明**（在 `config/strategy_config.yaml` 中修改策略逻辑参数）：
- 回测只是验证逻辑，实际交易效果取决于实盘环境。

---

## 3. 如何修改策略参数？

所有策略相关的参数都在 `config/strategy_config.yaml` 文件中。您可以使用记事本或任何文本编辑器打开它。

**关键参数速查：**
- `vt_symbols`: 交易的合约代码（如 `["RU2405.SHFE"]`）。
- `max_positions`: 最大持仓手数，控制风险。
- `position_ratio`: 每次开仓使用的资金比例。

*修改完成后，请务必**重启程序**（关闭黑色窗口再重新双击 `run.bat`）以生效。*

---

## 4. 怎么知道程序在正常运行？

程序启动后会出现一个黑色窗口（命令行界面）。
- **正常情况**：会看到类似 `INFO: 策略启动成功`，`INFO: 网关连接成功` 的白色文字滚动。
- **异常情况**：如果出现大量红色文字，或者窗口一闪而过，说明出错了。请去 `data/logs` 文件夹下查看最新的日志文件，发给技术人员。

---

## 5. 紧急停止

如果发现策略异常交易，或者需要紧急停止：
1. 直接点击黑色窗口右上角的 **“X”** 关闭窗口。
2. 程序会立即停止所有动作（注意：已发出的挂单可能需要您手动登录交易软件撤单，具体视交易所状态而定）。
